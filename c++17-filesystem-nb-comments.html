<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style>
 ins  {background-color: #CCFFCC; text-decoration: none;}
 del  {background-color: #FFCACA; text-decoration: none;}
</style>
<title>Filesystem NB Comments C++17</title>
</head>

<body>
<table>
<tr>
  <td align="left">Doc. no.:</td>
  <td align="left">DxxxxR0</td>
</tr>
<tr>
  <td align="left">Date:</td>
  <td align="left">
  <!--webbot bot="Timestamp" S-Type="EDITED" S-Format="%Y-%m-%d" startspan -->2016-10-29<!--webbot bot="Timestamp" endspan i-checksum="12058" --></td>
</tr>
<tr>
  <td align="left">Reply to:</td>
  <td align="left">Beman Dawes &lt;bdawes at acm dot org&gt;
</tr>
<tr>
  <td align="left">Audience:</td>
  <td align="left">Library</td>
</tr>
</table>

<h1>Proposed Disposition of C++17  National Body Comments on Filesystem</h1>

<p>This document proposes disposition of C++17 National Body Comments from
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0488r0.pdf">
P0488R0</a> and
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0489r0.pdf">
P0489R0</a> related to 27.10 [filesystems] in
<a href="http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2016/n4606.pdf">
N4606</a>.</p>

<p>The proposed dispositions represent the author&#39;s proposals. They do not 
necessarily represent the views of the C++ committee or the Library Working 
Group (LWG). </p>

<p>Following ISO procedures, the committee must respond to all national body 
comments as being accepted, accepted with modifications, or rejected. This 
document is organized into three sections of proposed dispositions corresponding 
to those categories, and two sections corresponding to work-in-process.</p>

<p><a href="#not-yet">Comments not yet considered</a><br>
<a href="#await-lwg">Comments awaiting LWG action</a><br>
<a href="#editorial">Editorial</a><br>
<a href="#accept-original">Accept WP wording from comment&#39;s <i>Proposed change</i></a><i><br>
</i><a href="#accept-modified">Accept comment with modified WP wording</a><br>
<a href="#reject">Reject comment; no consensus for change</a></p>

<h2><a name="not-yet"></a>NB Comments not yet considered</h2>

<h4>US 25; 27.10.8.4.10: has_filename() is equivalent to just !empty()</h4>
<p>Beman Dawes: Is the real issue a possibly incorrect post-condition for remove filename()?</p>

<h4>US 31; 27.10: Everything is defined in terms of one implicit host system</h4>
<p>Beman Dawes: Recommend rejection; That's by design, aimed at achieving portable behavior.
There may be an issue with under specification of class path for non-POSIX/non-Windows
operating systems, but that is best handled via CA 2-8 NB comments.</p>

<h4>US 32; 27.10.2.1: Meaning of 27.10.2.1 unclear</h4>

<p>Beman Dawes: US 33-40 deal with 27.10.4 Terms and definitions [fs.definitions].
Providing correct, non-controversial definitions is difficult. Unless a definition is
causing problems with interpretation of the library involved, it may be best to leave it alone.</p>
<h4>US 33; 27.10.4.2: Definition of <i>canonical path</i> problematic</h4>
<h4>US 34; 27.10.4.5: Are there attributes of a file that are not an aspect of the file system?</h4>
<h4>US 35; 27.10.4.6: What synchronization is required to avoid a file system race?</h4>
<h4>US 36; 27.10.4.9: Symbolic links themselves are attached to a directory via (hard) links</h4>
<h4>US 37; 27.10.4.12: The term “redundant current directory (dot) elements” is not defined.</h4>
<h4>US 40; 27.10.4.15: Not all directories have a parent.</h4>

<h4>US 43; 27.10.5: Concerns about <i>encoded character types</i></h4>

<h4>US 44; 27.10.8: Definition of path in terms of a string requires leaky abstraction</h4>
<p>Beman Dawes: Recommend rejection at this time. The Proposed change amounts to a redesign and rewrite of the
class path specification. Such an extensive change would require a separate paper that
included proposed wording.</p>

<h4>US 45; 27.10.8.1: Generic format portability compromised by unspecified root-name.</h4>
<p>Beman Dawes: Recommend rejection at this time.</p>

<h4>US 46; 27.10.8.1: <i>filename</i> can be empty so productions for <i>relative-path</i> are redundant.</h4>
<p>Beman Dawes: Recommend rejection at this time. Such an extensive change would require a separate paper that
included proposed wording.</p>

<h4>US 48; 27.10.8.1: Multiple separators are often meaningful in a <i>root-name</i></h4>
<p>Beman Dawes: Will provide proposed wording for the Proposed change "Limit the scope of the paragraph to the <i>relative-path</i>.".</p>

<h4>US 49; 27.10.8.2.2: What does “method of conversion method” mean?</h4>
<p>Beman Dawes: It is a mistake. Suggest fix is editorial; Change
/method of conversion method/method of conversion/ in three places.</p>

<h4>US 51; 27.10.8.4.3 ¶2.3: Failing to add / when appending empty string prevents useful applications</h4>
<p>Beman Dawes: Not clear to me why <code>p /= "/"</code> would not be satisfactory,
unless there is concern
that code like <code>p /= some_string</code> might not work as intended. No proposed wording,
so unless a volunteer provides wording, suggest "Reject; no consensus at this time" and open an issue.</p>

<h4>US 52; 27.10.8.4.5 ¶5: <code>remove_filename()</code> postcondition is not by itself a definition</h4>
<p>Beman Dawes provides wording:</p>
<blockquote>
<i>Change 27.10.8.4.5 [path.modifiers] ¶5:</i>
<blockquote>
<i>Postcondition:</i> <del><code>!has_filename()</code></del>
<ins>For an object <code>p</code> of type <code>path</code>,
<code>p.remove_filename().has_filename() == false</code></ins>.
</blockquote>
</blockquote>

<h4>US 53; 27.10.8.4.5 ¶7: <code>remove_filename()</code>'s name does not correspond to
its behavior</h4>

<p>Beman Dawes: This issue needs to be resolved before C++17 ships.</p>
<p>My initial reaction is that the name should be changed. Bikeshed:
<code>remove_last_element()</code> rather than the suggested <code>remove_component()</code>.

<h4>US 54; 27.10.8.4.5 ¶10: <code>remove_filename()</code> is broken</h4>

<h4>US 55; 27.10.8.4.5 ¶11:
<code>replace_extension()</code>'s use of <code>path</code> as parameter type is inappropriate</h4>

<p>Beman Dawes:</p>
<p>Very strongly recommend rejection. <code>path</code> is the filesystem
library's vocabulary type for both fully formed paths and for path fragments. Changing
the vocabulary type for path fragments to <code>string_type</code>, as suggested in this
NB comment, would make it more difficult to write code that is portable between operating systems
that use different <code>string_type</code>s (i.e. between POSIX and Windows).
For example, <code>p.replace_extension(".txt")</code> would work on POSIX but fail to compile on Windows. 
It would also make code more difficult that must deal with character encodings that differ
from the operating system's expected encoding for <code>string_type</code>. As written, this is a
"strongly against" issue for me.

<p>An alternative view might be that there is a defect in the clarity of 27.10.8 [class.path] ¶1. Perhaps
it should be changed something like this:</p>

<blockquote>
<p>An object of class path represents a path (27.10.4.17) <ins>or a portion of a path</ins>
 and contains a pathname (27.10.4.18) <ins>or a portion of a pathname</ins>. Such an object
is concerned only with the lexical and syntactic aspects of a path. The path does not necessarily exist in
external storage, and the pathname is not necessarily valid for the current operating system or for a particular
file system.</p>

<p><ins>[<i>Note:</i> Class path is used to hide the difference between the string types
 used to represent pathnames by different operating systems. &mdash; <i>end note</i>]</ins></p>

</blockquote>
 
<h4>US 56; 27.10.8.4.5 ¶11.2: </h4>
<h4>US 57: </h4>
<h4>US 58: </h4>
<h4>US 59: </h4>
<h4>US 60: </h4>
<h4>US 62: </h4>
<h4>US 63: </h4>
<h4>US 74: </h4>
<h4>US 75: </h4>
<h4>US 76: </h4>
<h4>US 77: </h4>
<h4>US 78: </h4>
<h4>US 79: </h4>
<h4>US 18: </h4>
<h4>CA 3: </h4>
<h4>CA 4: </h4>
<h4>CA 5: </h4>
<h4>CA 6: </h4>
<h4>CA 7: </h4>
<h4>CA 8: </h4>


<h2><a name="await-lwg"></a>Comments awaiting LWG action</h2>

<h3>Recommend Accept</h3>

<h3>Recommend Accept with modifications</h3>

<h4>US 61: Leading dots in filename() should not begin an extension</h4>

<blockquote>

<p>Cases worth considering, with suggested decompositions:</p>

<blockquote>

  <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111">
    <tr>
      <td><i><b><code>path p</code></b></i></td>
      <td><i><b><code>p.stem()</code></b></i></td>
      <td><i><b><code>p.extension()</code></b></i></td>
    </tr>
    <tr>
      <td><code>&quot;.bashrc&quot;</code></td>
      <td><code>&quot;.bashrc&quot;</code></td>
      <td>&quot;&quot;</td>
    </tr>
    <tr>
      <td><code>&quot;..abc&quot;</code></td>
      <td><code>&quot;..abc&quot;</code></td>
      <td>&quot;&quot;</td>
    </tr>
    <tr>
      <td>&quot;<code>...abc</code>&quot;</td>
      <td>&quot;<code>...abc</code>&quot;</td>
      <td>&quot;&quot;</td>
    </tr>
    <tr>
      <td>&quot;<code>abc..def</code>&quot;</td>
      <td>&quot;<code>abc</code>&quot;</td>
      <td>&quot;<code>..def</code>&quot;</td>
    </tr>
    <tr>
      <td>&quot;<code>abc...def</code>&quot;</td>
      <td>&quot;<code>abc</code>&quot;</td>
      <td>&quot;<code>...def</code>&quot;</td>
    </tr>
  </table>
</blockquote>

<p>Change 27.10.8.4.9 [path.decompose] ¶ 8:</p>

<blockquote>

<p><code>path stem() const;</code></p>

  <blockquote>

<p><i>Returns:</i> if <code>filename()</code> contains a period <del>but does not 
consist solely of one or two periods</del> <ins>other than in a sequence of one or 
more beginning periods</ins>, returns the substring of <code>filename()</code> 
starting at its beginning and ending with the character before the <del>last period</del> <ins>
first period of the last sequence of one or more periods</ins>.
Otherwise, returns <code>filename()</code>.</p>

  </blockquote>
</blockquote>

<p>Change 27.10.8.4.9 [path.decompose] ¶ 10:</p>

<blockquote>

<p><code>path extension() const;</code></p>

  <blockquote>

<p><i>Returns:</i> if <code>filename()</code> contains a period <del>but does not 
consist solely of one or two periods</del> <ins>other than in a sequence of one or 
more beginning periods</ins>, returns the substring of <code>filename()</code> 
starting at <ins>the beginning of</ins> the rightmost <ins>sequence of</ins> period<ins>s</ins> and for the remainder of the path. Otherwise, 
returns an empty <code>path</code> object.</p>

  </blockquote>
</blockquote>

</blockquote>

<h3>Recommend Reject</h3>

<p><b>US 185</b> - Fold <code>error_code</code> and non-<code>error_code</code> 
signatures into one signature.</p>

<blockquote>

<p> <b>Rationale:</b> Does not handle one being <code>
noexcept(true)</code> and the other <code>noexcept(false)</code>.</p>

</blockquote>

<p><b>FI 14</b> - AKA
<a name="2761" href="http://cplusplus.github.io/LWG/lwg-closed.html#2761">2761.</a>
<tt>directory_entry</tt> comparisons are members.&nbsp; </p>

<blockquote>

<p> <b>Rationale:</b> 2761 
is NAD.</p>

</blockquote>

<h3>No recommendation</h3>

<p><b>US 73, CA 2</b> - <i>root-name</i> is effectively implementation defined.</p>

<blockquote>

<p>Change under root-name in the grammar of subclause 27.10.8.1 [path.generic]:</p>

<blockquote>

<p>An <ins>implementation defined path prefix</ins> <del>operating system dependant name</del> that 
identifies the starting location for absolute paths.</p>

</blockquote>

<p>Add a new paragraph before paragraph 1 of [path.generic]:</p>

<blockquote>

<p><ins>The <i>root-name</i> in a <i>pathname</i> is the longest sequence of 
characters that could possibly form a <i>root-name</i>.</ins></p>

</blockquote>

</blockquote>

<h2><a name="editorial"></a>Editorial</h2>

<p>Editorial NB comments are processed by the Project Editor.</p>

<p><b>US 38:</b>&nbsp; Duplicates §17.3.16.</p>

<blockquote>

<p> <b>Note:</b> Recommend rejection. 
The comment is not correct. 27.10.4.13 provides additional wording&nbsp; not 
present in 17.3.16. </p>

</blockquote>

<p><b>US 39:</b> Remove note: Dot and dot-dot are not directories. </p>

<blockquote>

<p> <b>Note:</b> 
Recommend rejection. The note was added to resolve confusion over dot and 
dot-dot.</p>

</blockquote>

<p><b>US 41:</b> The term “parent directory” for a (non-directory) file is 
unusual. </p>

<p><b>US 42:</b> Pathname resolution does not always resolve a symlink.</p>

<p><b>US 47:</b> “.” and “..” already match the name production. </p>

<blockquote>

<p> <b>Note: </b>
This may well be an issue, but likely substantive rather than editorial.</p>

</blockquote>

<p><b>US 50:</b> 27.10.8.1 ¶ 1.4 largely redundant with ¶ 1.3.</p>

<h2><a name="accept-original"></a>Accept WP wording from comment&#39;s <i>Proposed 
change</i></h2>

<h2><a name="accept-modified"></a>Accept comment with modified WP wording</h2>

<h2><a name="reject"></a>Reject comment; no consensus for change</h2>

<p>&quot;Rationale:&quot; where present, provides rationale for rejection.</p>

<hr>

</body>

</html>